<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>YT Music</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
body{margin:0;font-family:system-ui;background:#0b0b0b;color:#fff}
header{
  display:flex;gap:10px;align-items:center;
  padding:12px;background:#141414;position:sticky;top:0;z-index:10
}
.logo{color:red;font-weight:700;font-size:18px}

/* SEARCH BOX */
.search-box{
  flex:1;display:flex;gap:6px
}
.search-box input{
  flex:1;padding:10px;background:#000;color:#fff;
  border:1px solid #333;border-radius:8px
}
.search-box button{
  padding:10px 14px;border:none;border-radius:8px;
  background:red;color:#fff;font-size:14px
}

/* PLAYER */
.player-wrap{
  max-width:900px;margin:14px auto;
  aspect-ratio:16/9;border-radius:16px;
  overflow:hidden;display:none
}
.player-wrap iframe{width:100%;height:100%}

/* MINI PLAYER (DRAGGABLE) */
.player-wrap.mini{
  position:fixed;bottom:100px;right:16px;
  width:260px;z-index:50;
  cursor:move;box-shadow:0 0 18px rgba(0,0,0,.8)
}

/* FEED */
.feed{
  display:grid;
  grid-template-columns:repeat(auto-fill,minmax(160px,1fr));
  gap:14px;padding:12px
}
.card{
  background:#141414;border:1px solid #2a2a2a;
  border-radius:14px;padding:8px;cursor:pointer
}
.card img{width:100%;border-radius:10px}
.card span{display:block;font-size:13px;margin-top:6px}

/* BOTTOM NAV */
nav{
  position:fixed;bottom:0;left:0;right:0;
  display:flex;justify-content:space-around;
  background:#111;padding:14px 0
}
nav button{
  background:none;border:none;color:#fff;
  font-size:14px;display:flex;
  flex-direction:column;align-items:center
}

.spacer{height:120px}
</style>
</head>

<body>

<header>
  <div class="logo">YT Music</div>
  <div class="search-box">
    <input id="q" placeholder="Search songs‚Ä¶">
    <button onclick="doSearch()">Search</button>
  </div>
</header>

<!-- PLAYER -->
<div id="playerWrap" class="player-wrap">
  <iframe id="player"
    allow="autoplay; encrypted-media"
    allowfullscreen></iframe>
</div>

<!-- FEED -->
<div id="feed" class="feed"></div>
<div class="spacer"></div>

<!-- NAV -->
<nav>
  <button onclick="goHome()">üè†<span>Home</span></button>
  <button onclick="goSearch()">üîç<span>Search</span></button>
</nav>

<script>
/* ================= CONFIG ================= */
const API_KEY = "AIzaSyDegWP6p4oz6QHaKe55UHE50KGbviyycfU";
const ORIGIN = location.origin;

/* ================= STATE ================= */
let nextPageToken="";
let mode="home";

const feed=document.getElementById("feed");
const playerWrap=document.getElementById("playerWrap");
const player=document.getElementById("player");

/* ================= VIDEO ID ================= */
function getVideoId(item){
  if(!item||!item.id) return null;
  if(typeof item.id==="string") return item.id;
  if(item.id.videoId) return item.id.videoId;
  return null;
}

/* ================= ROUTED PLAY ================= */
function playVideo(videoId, push=true){
  if(!videoId) return;

  playerWrap.style.display="block";
  player.src=
    `https://www.youtube-nocookie.com/embed/${videoId}`+
    `?autoplay=1&rel=0&modestbranding=1&origin=${ORIGIN}`;

  if(push){
    history.pushState(
      {video:videoId},
      "",
      "#watch="+videoId
    );
  }
}

/* ================= ROUTER ================= */
window.onpopstate = e => {
  if(e.state && e.state.video){
    playVideo(e.state.video,false);
  }else{
    playerWrap.style.display="none";
    player.src="";
  }
};

/* ================= MINI PLAYER LOGIC ================= */
window.addEventListener("scroll",()=>{
  if(player.src){
    if(window.scrollY>250) playerWrap.classList.add("mini");
    else playerWrap.classList.remove("mini");
  }
});

/* DRAG */
let drag=false,dx=0,dy=0;
playerWrap.addEventListener("mousedown",e=>{
  if(!playerWrap.classList.contains("mini")) return;
  drag=true;
  dx=e.clientX-playerWrap.offsetLeft;
  dy=e.clientY-playerWrap.offsetTop;
});
window.addEventListener("mousemove",e=>{
  if(!drag) return;
  playerWrap.style.left=(e.clientX-dx)+"px";
  playerWrap.style.top=(e.clientY-dy)+"px";
});
window.addEventListener("mouseup",()=>drag=false);

/* ================= DATA ================= */
function buildUrl(){
  if(mode==="search"){
    const q=document.getElementById("q").value||"music";
    return `https://www.googleapis.com/youtube/v3/search?part=snippet&type=video&q=${encodeURIComponent(q)}&maxResults=12&pageToken=${nextPageToken}&key=${API_KEY}`;
  }
  return `https://www.googleapis.com/youtube/v3/videos?part=snippet&chart=mostPopular&regionCode=IN&videoCategoryId=10&maxResults=12&pageToken=${nextPageToken}&key=${API_KEY}`;
}

function loadMore(){
  fetch(buildUrl())
  .then(r=>r.json())
  .then(d=>{
    nextPageToken=d.nextPageToken||"";
    d.items.forEach(item=>{
      const id=getVideoId(item);
      if(!id) return;

      const c=document.createElement("div");
      c.className="card";
      c.innerHTML=`
        <img src="${item.snippet.thumbnails.medium.url}">
        <span>${item.snippet.title}</span>`;
      c.onclick=()=>playVideo(id);
      feed.appendChild(c);
    });
  });
}

/* ================= NAV ================= */
function goHome(){
  mode="home";
  feed.innerHTML="";
  nextPageToken="";
  history.pushState({}, "", "#home");
  loadMore();
}

function goSearch(){
  mode="search";
  feed.innerHTML="";
  nextPageToken="";
  history.pushState({}, "", "#search");
}

function doSearch(){
  goSearch();
  loadMore();
}

/* INIT */
if(location.hash.startsWith("#watch=")){
  playVideo(location.hash.split("=")[1],false);
}else{
  goHome();
}
</script>

</body>
</html>
